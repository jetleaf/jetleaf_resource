<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="jetleaf_resource API docs, for the Dart programming language.">
  <title>jetleaf_resource - Dart API docs</title>


  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="static-assets/github.css?v1">
  <link rel="stylesheet" href="static-assets/styles.css?v1">
  <link rel="icon" href="static-assets/favicon.png?v1">
  
</head>

<body data-base-href="" data-using-base-href="false" class="light-theme">
<div id="overlay-under-drawer"></div>
<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="https://jetleaf.hapnium.com">jetleaf_resource package</a></li>
  </ol>
  <div class="self-name">jetleaf_resource</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <button class="toggle" id="theme-button" title="Toggle between light and dark mode" aria-label="Light and dark mode toggle">
    <span id="dark-theme-button" class="material-symbols-outlined" aria-hidden="true">
      dark_mode
    </span>
    <span id="light-theme-button" class="material-symbols-outlined" aria-hidden="true">
      light_mode
    </span>
  </button>
</header>
<main>
  <div id="dartdoc-main-content" class="main-content">
      
<section class="desc markdown">
  <h1 id="-jetleaf-resource--caching--rate-limiting">üíæ JetLeaf Resource ‚Äî Caching &amp; Rate Limiting</h1>
<p><a href="https://pub.dev/packages/jetleaf_resource"><img src="https://img.shields.io/badge/version-1.0.0-blue" alt="pub package"></a>
<a href="#license"><img src="https://img.shields.io/badge/license-JetLeaf-green" alt="License"></a>
<a href="https://dart.dev"><img src="https://img.shields.io/badge/sdk-%3E%3D3.9.0-blue" alt="Dart SDK"></a></p>
<p>Unified resource management utilities for caching, rate limiting, and key generation in JetLeaf applications with declarative conditions and automatic pod integration.</p>
<h2 id="-overview">üìã Overview</h2>
<p><code>jetleaf_resource</code> provides resource management features:</p>
<ul>
<li><strong>Caching</strong> ‚Äî In-memory cache with TTL and automatic expiration</li>
<li><strong>Rate Limiting</strong> ‚Äî Request throttling with multiple strategies</li>
<li><strong>Key Generators</strong> ‚Äî Customizable cache key generation</li>
<li><strong>Conditions</strong> ‚Äî Declarative cache/rate-limit conditions</li>
<li><strong>Pod Integration</strong> ‚Äî Automatic resource registration as pods</li>
<li><strong>Performance</strong> ‚Äî Improved response times and reduced load</li>
</ul>
<h2 id="-quick-start">üöÄ Quick Start</h2>
<h3 id="installation">Installation</h3>
<pre class="language-yaml"><code class="language-yaml">dependencies:
  jetleaf_resource:
    path: ./jetleaf_resource
</code></pre>
<h3 id="basic-caching">Basic Caching</h3>
<pre class="language-dart"><code class="language-dart">import 'package:jetleaf_resource/jetleaf_resource.dart';

class UserService {
  final Map&lt;String, User&gt; _cache = {};

  Future&lt;User&gt; getUser(String id) async {
    // Check cache first
    if (_cache.containsKey(id)) {
      print('Cache hit for user $id');
      return _cache[id]!;
    }

    // Fetch from database
    print('Fetching user $id from database');
    final user = await _fetchFromDatabase(id);
    
    // Store in cache
    _cache[id] = user;
    return user;
  }

  Future&lt;User&gt; _fetchFromDatabase(String id) async {
    // Simulate database call
    await Future.delayed(Duration(milliseconds: 100));
    return User(id: id, name: 'User $id');
  }
}

class User {
  final String id;
  final String name;
  User({required this.id, required this.name});
}

void main() async {
  final service = UserService();
  
  // First call: fetches from database
  var user = await service.getUser('123');
  print('User: ${user.name}');
  
  // Second call: from cache
  user = await service.getUser('123');
  print('User: ${user.name}');
}
</code></pre>
<h3 id="basic-rate-limiting">Basic Rate Limiting</h3>
<pre class="language-dart"><code class="language-dart">import 'package:jetleaf_resource/jetleaf_resource.dart';

class ApiLimiter {
  int _requestCount = 0;
  DateTime _windowStart = DateTime.now();
  final int _maxRequests = 10;
  final Duration _windowDuration = Duration(minutes: 1);

  bool canMakeRequest() {
    final now = DateTime.now();
    
    // Reset window if expired
    if (now.difference(_windowStart) &gt; _windowDuration) {
      _requestCount = 0;
      _windowStart = now;
    }

    if (_requestCount &lt; _maxRequests) {
      _requestCount++;
      return true;
    }

    return false;
  }
}

void main() {
  final limiter = ApiLimiter();

  for (int i = 0; i &lt; 15; i++) {
    if (limiter.canMakeRequest()) {
      print('Request $i allowed');
    } else {
      print('Request $i blocked (rate limit exceeded)');
    }
  }
}
</code></pre>
<h2 id="-key-features">üìö Key Features</h2>
<h3 id="1-cache-management">1. Cache Management</h3>
<p><strong>Flexible in-memory caching</strong>:</p>
<pre class="language-dart"><code class="language-dart">import 'package:jetleaf_resource/jetleaf_resource.dart';

class CacheExample {
  final Map&lt;String, CacheEntry&gt; _cache = {};

  void set&lt;T&gt;(String key, T value, {Duration? ttl}) {
    _cache[key] = CacheEntry(
      value: value,
      expiresAt: ttl != null ? DateTime.now().add(ttl) : null,
    );
  }

  T? get&lt;T&gt;(String key) {
    final entry = _cache[key];
    
    // Check if expired
    if (entry != null &amp;&amp; entry.expiresAt != null) {
      if (DateTime.now().isAfter(entry.expiresAt!)) {
        _cache.remove(key);
        return null;
      }
    }

    return entry?.value as T?;
  }

  void invalidate(String key) {
    _cache.remove(key);
  }

  void clear() {
    _cache.clear();
  }

  int get size =&gt; _cache.length;
}

class CacheEntry {
  final Object? value;
  final DateTime? expiresAt;
  
  CacheEntry({required this.value, this.expiresAt});
}

void main() {
  final cache = CacheExample();

  // Set with 1 minute TTL
  cache.set('user:123', {'name': 'John'}, ttl: Duration(minutes: 1));
  
  // Get value
  var value = cache.get('user:123');
  print('Cached: $value');

  // Invalidate specific key
  cache.invalidate('user:123');
  value = cache.get('user:123');
  print('After invalidate: $value');
}
</code></pre>
<h3 id="2-cache-key-generation">2. Cache Key Generation</h3>
<p><strong>Customizable key generation strategies</strong>:</p>
<pre class="language-dart"><code class="language-dart">import 'package:jetleaf_resource/jetleaf_resource.dart';

abstract class KeyGenerator {
  String generate(String prefix, List&lt;dynamic&gt; params);
}

class SimpleKeyGenerator implements KeyGenerator {
  @override
  String generate(String prefix, List&lt;dynamic&gt; params) {
    return '$prefix:${params.join(':')}';
  }
}

class CompositeKeyGenerator implements KeyGenerator {
  final String Function(dynamic value) converter;
  
  CompositeKeyGenerator({required this.converter});

  @override
  String generate(String prefix, List&lt;dynamic&gt; params) {
    final converted = params.map(converter).join(':');
    return '$prefix:$converted';
  }
}

void main() {
  final simpleGen = SimpleKeyGenerator();
  
  // Generate cache keys
  var key1 = simpleGen.generate('user', [123, 'profile']);
  print('Key: $key1');  // user:123:profile

  // Composite with custom converter
  final compositeGen = CompositeKeyGenerator(
    converter: (value) =&gt; value is User ? value.id : value.toString(),
  );

  final user = User(id: '456', name: 'Alice');
  var key2 = compositeGen.generate('user', [user, 'details']);
  print('Key: $key2');  // user:456:details
}

class User {
  final String id;
  final String name;
  User({required this.id, required this.name});
}
</code></pre>
<h3 id="3-rate-limiting-strategies">3. Rate Limiting Strategies</h3>
<p><strong>Multiple rate limiting approaches</strong>:</p>
<pre class="language-dart"><code class="language-dart">import 'package:jetleaf_resource/jetleaf_resource.dart';

// Fixed window counter
class FixedWindowLimiter {
  final int maxRequests;
  final Duration window;
  DateTime _windowStart = DateTime.now();
  int _count = 0;

  FixedWindowLimiter({required this.maxRequests, required this.window});

  bool allowRequest() {
    final now = DateTime.now();
    
    if (now.difference(_windowStart) &gt; window) {
      _windowStart = now;
      _count = 0;
    }

    if (_count &lt; maxRequests) {
      _count++;
      return true;
    }
    return false;
  }
}

// Token bucket algorithm
class TokenBucketLimiter {
  final double tokensPerSecond;
  double _tokens;
  DateTime _lastRefill;

  TokenBucketLimiter({required this.tokensPerSecond})
    : _tokens = tokensPerSecond,
      _lastRefill = DateTime.now();

  bool allowRequest({int tokensNeeded = 1}) {
    _refillTokens();
    
    if (_tokens &gt;= tokensNeeded) {
      _tokens -= tokensNeeded;
      return true;
    }
    return false;
  }

  void _refillTokens() {
    final now = DateTime.now();
    final elapsed = now.difference(_lastRefill).inMilliseconds / 1000.0;
    _tokens = (_tokens + elapsed * tokensPerSecond).clamp(0, tokensPerSecond);
    _lastRefill = now;
  }
}

void main() {
  // Fixed window: max 10 requests per minute
  final fwLimiter = FixedWindowLimiter(
    maxRequests: 10,
    window: Duration(minutes: 1),
  );

  // Token bucket: 5 requests per second
  final tbLimiter = TokenBucketLimiter(tokensPerSecond: 5);

  print('Fixed window test:');
  for (int i = 0; i &lt; 12; i++) {
    print('Request $i: ${fwLimiter.allowRequest()}');
  }

  print('\nToken bucket test:');
  for (int i = 0; i &lt; 7; i++) {
    print('Request $i: ${tbLimiter.allowRequest()}');
  }
}
</code></pre>
<h3 id="4-conditional-caching">4. Conditional Caching</h3>
<p><strong>Cache only under specific conditions</strong>:</p>
<pre class="language-dart"><code class="language-dart">import 'package:jetleaf_resource/jetleaf_resource.dart';

class ConditionalCache&lt;T&gt; {
  final Map&lt;String, CacheEntry&lt;T&gt;&gt; _cache = {};
  final bool Function(T value)? condition;

  ConditionalCache({this.condition});

  void set(String key, T value) {
    // Only cache if condition passes
    if (condition == null || condition!(value)) {
      _cache[key] = CacheEntry(
        value: value,
        createdAt: DateTime.now(),
      );
    }
  }

  T? get(String key) =&gt; _cache[key]?.value;

  void clear() =&gt; _cache.clear();
}

class CacheEntry&lt;T&gt; {
  final T value;
  final DateTime createdAt;
  
  CacheEntry({required this.value, required this.createdAt});
}

class User {
  final String id;
  final String name;
  final bool isActive;

  User({
    required this.id,
    required this.name,
    required this.isActive,
  });
}

void main() {
  // Only cache active users
  final userCache = ConditionalCache&lt;User&gt;(
    condition: (user) =&gt; user.isActive,
  );

  final activeUser = User(id: '1', name: 'Alice', isActive: true);
  final inactiveUser = User(id: '2', name: 'Bob', isActive: false);

  userCache.set('user:1', activeUser);
  userCache.set('user:2', inactiveUser);

  print('Active user cached: ${userCache.get('user:1') != null}');      // true
  print('Inactive user cached: ${userCache.get('user:2') != null}');    // false
}
</code></pre>
<h3 id="5-pod-integration">5. Pod Integration</h3>
<p><strong>Automatic resource registration as pods</strong>:</p>
<pre class="language-dart"><code class="language-dart">import 'package:jetleaf_resource/jetleaf_resource.dart';
import 'package:jetleaf_pod/jetleaf_pod.dart';

@Service()
class CachedUserService {
  final Map&lt;String, User&gt; _cache = {};

  Future&lt;User&gt; getUser(String id) async {
    if (_cache.containsKey(id)) {
      return _cache[id]!;
    }

    final user = await _fetchUser(id);
    _cache[id] = user;
    return user;
  }

  void invalidateUser(String id) {
    _cache.remove(id);
  }

  Future&lt;User&gt; _fetchUser(String id) async {
    // Database call
    await Future.delayed(Duration(milliseconds: 50));
    return User(id: id, name: 'User $id');
  }
}

class User {
  final String id;
  final String name;
  User({required this.id, required this.name});
}

// Auto-configured in pod
void main() async {
  final factory = DefaultListablePodFactory();

  factory.registerDefinition(
    PodDefinition(
      name: 'userService',
      create: () =&gt; CachedUserService(),
      scope: Scope.singleton,
    ),
  );

  final service = factory.getPod&lt;CachedUserService&gt;('userService');
  final user = await service.getUser('123');
  print('User: ${user.name}');
}
</code></pre>
<h2 id="-common-patterns">üéØ Common Patterns</h2>
<h3 id="pattern-1-service-with-cache-layer">Pattern 1: Service with Cache Layer</h3>
<pre class="language-dart"><code class="language-dart">import 'package:jetleaf_resource/jetleaf_resource.dart';

class UserRepository {
  Future&lt;User&gt; getUserById(String id) async {
    // Simulate database query
    await Future.delayed(Duration(milliseconds: 200));
    return User(id: id, name: 'User $id');
  }
}

class CachedUserService {
  final UserRepository _repository;
  final Map&lt;String, CacheEntry&gt; _cache = {};
  static const _cacheTTL = Duration(minutes: 5);

  CachedUserService(this._repository);

  Future&lt;User&gt; getUser(String id) async {
    final cached = _checkCache(id);
    if (cached != null) {
      print('Cache HIT for $id');
      return cached;
    }

    print('Cache MISS for $id, fetching from DB');
    final user = await _repository.getUserById(id);
    _cache[id] = CacheEntry(user, _cacheTTL);
    return user;
  }

  User? _checkCache(String id) {
    final entry = _cache[id];
    if (entry != null &amp;&amp; !entry.isExpired) {
      return entry.value as User;
    }
    _cache.remove(id);
    return null;
  }
}

class CacheEntry {
  final Object? value;
  final DateTime expiresAt;

  CacheEntry(this.value, Duration ttl)
    : expiresAt = DateTime.now().add(ttl);

  bool get isExpired =&gt; DateTime.now().isAfter(expiresAt);
}

class User {
  final String id;
  final String name;
  User({required this.id, required this.name});
}

void main() async {
  final repo = UserRepository();
  final service = CachedUserService(repo);

  // First call: 200ms from database
  var start = DateTime.now();
  var user = await service.getUser('1');
  print('First call took: ${DateTime.now().difference(start).inMilliseconds}ms');

  // Second call: instant from cache
  start = DateTime.now();
  user = await service.getUser('1');
  print('Second call took: ${DateTime.now().difference(start).inMilliseconds}ms');
}
</code></pre>
<h3 id="pattern-2-api-rate-limiting">Pattern 2: API Rate Limiting</h3>
<pre class="language-dart"><code class="language-dart">import 'package:jetleaf_resource/jetleaf_resource.dart';

class ApiRateLimiter {
  final int maxRequests;
  final Duration timeWindow;
  final Map&lt;String, List&lt;DateTime&gt;&gt; _requests = {};

  ApiRateLimiter({
    required this.maxRequests,
    required this.timeWindow,
  });

  bool isAllowed(String clientId) {
    final now = DateTime.now();
    final windowStart = now.subtract(timeWindow);

    // Get or create request list for client
    final requests = _requests[clientId] ?? [];
    
    // Remove old requests outside window
    requests.removeWhere((time) =&gt; time.isBefore(windowStart));

    // Check limit
    if (requests.length &lt; maxRequests) {
      requests.add(now);
      _requests[clientId] = requests;
      return true;
    }

    return false;
  }

  int getRemainingRequests(String clientId) {
    final requests = _requests[clientId] ?? [];
    return maxRequests - requests.length;
  }
}

void main() {
  final limiter = ApiRateLimiter(
    maxRequests: 5,
    timeWindow: Duration(minutes: 1),
  );

  const clientId = 'client-123';

  for (int i = 0; i &lt; 7; i++) {
    final allowed = limiter.isAllowed(clientId);
    final remaining = limiter.getRemainingRequests(clientId);
    print('Request $i: ${allowed ? 'ALLOWED' : 'BLOCKED'} (remaining: $remaining)');
  }
}
</code></pre>
<h2 id="-common-issues">‚ö†Ô∏è Common Issues</h2>
<table>
<thead>
<tr>
<th>Issue</th>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cache grows unbounded</td>
<td>No TTL or eviction</td>
<td>Set TTL and implement LRU eviction</td>
</tr>
<tr>
<td>Rate limit too strict</td>
<td>Window too small</td>
<td>Increase maxRequests or timeWindow</td>
</tr>
<tr>
<td>Cache misses</td>
<td>Wrong key generation</td>
<td>Verify key format consistency</td>
</tr>
<tr>
<td>Memory leak</td>
<td>Expired entries not removed</td>
<td>Implement cleanup/invalidation</td>
</tr>
<tr>
<td>False positives</td>
<td>Clock skew</td>
<td>Use consistent time source</td>
</tr>
</tbody>
</table>
<h2 id="-best-practices">üìã Best Practices</h2>
<h3 id="-do">‚úÖ DO</h3>
<ul>
<li>Set appropriate TTL for cache entries</li>
<li>Implement cache invalidation on data updates</li>
<li>Use meaningful cache key prefixes</li>
<li>Monitor cache hit ratios</li>
<li>Implement exponential backoff with rate limiting</li>
<li>Use specific rate limits per client/endpoint</li>
<li>Clear cache on errors</li>
<li>Log cache operations</li>
<li>Test cache behavior under load</li>
<li>Implement cache warming for hot data</li>
</ul>
<h3 id="-dont">‚ùå DON'T</h3>
<ul>
<li>Cache sensitive data (passwords, tokens)</li>
<li>Use unbounded caches without limits</li>
<li>Ignore cache invalidation</li>
<li>Cache all requests indiscriminately</li>
<li>Set TTL too long (stale data)</li>
<li>Set TTL too short (cache thrashing)</li>
<li>Cache without considering memory impact</li>
<li>Use weak keys that don't properly differentiate</li>
<li>Forget to handle cache misses gracefully</li>
<li>Over-cache frequently changing data</li>
</ul>
<h2 id="-dependencies">üì¶ Dependencies</h2>
<ul>
<li><strong><code>jetleaf_lang</code></strong> ‚Äî Language utilities</li>
<li><strong><code>jetleaf_logging</code></strong> ‚Äî Logging support</li>
<li><strong><code>jetleaf_pod</code></strong> ‚Äî Pod integration</li>
<li><strong><code>jetleaf_core</code></strong> ‚Äî Core framework</li>
<li><strong><code>jetleaf_env</code></strong> ‚Äî Configuration</li>
</ul>
<h2 id="-related-packages">üîó Related Packages</h2>
<ul>
<li><strong><code>jetleaf_web</code></strong> ‚Äî HTTP caching headers</li>
<li><strong><code>jetleaf_pod</code></strong> ‚Äî Pod lifecycle</li>
<li><strong><code>jetleaf_core</code></strong> ‚Äî Application lifecycle</li>
</ul>
<h2 id="-license">üìÑ License</h2>
<p>This package is part of the JetLeaf Framework. See LICENSE in the root directory.</p>
<h2 id="-support">üìû Support</h2>
<p>For issues, questions, or contributions, visit:</p>
<ul>
<li><a href="https://github.com/jetleaf/jetleaf_resource/issues">GitHub Issues</a></li>
<li><a href="https://jetleaf.hapnium.com/docs/resource">Documentation</a></li>
<li><a href="https://forum.jetleaf.hapnium.com">Community Forum</a></li>
</ul>
<hr>
<p><strong>Created with ‚ù§Ô∏è by <a href="https://hapnium.com">Hapnium</a></strong></p>
</section>


      <section class="summary">
          <h2>Libraries</h2>
        <dl>
          <dt id="cache">
  <span class="name"><a href="cache/">cache</a></span> 

</dt>
<dd>JetLeaf Cache Library
</dd>

          <dt id="jetleaf_resource">
  <span class="name"><a href="jetleaf_resource/">jetleaf_resource</a></span> 

</dt>
<dd>JetLeaf Resource Library
</dd>

          <dt id="rate_limit">
  <span class="name"><a href="rate_limit/">rate_limit</a></span> 

</dt>
<dd>JetLeaf Rate Limit Library
</dd>

        </dl>
      </section>
  </div> <!-- /.main-content -->
  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>
<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="https://jetleaf.hapnium.com">jetleaf_resource package</a></li>
</ol>

    <h5 class="hidden-xs"><span class="package-name">jetleaf_resource</span> <span class="package-kind">package</span></h5>
    <ol>
      <li class="section-title">Libraries</li>
      <li><a href="cache/">cache</a></li>
      <li><a href="jetleaf_resource/">jetleaf_resource</a></li>
      <li><a href="rate_limit/">rate_limit</a></li>
</ol>

  </div>
  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
  </div>
</main>
<footer>
  <span class="no-break">
    jetleaf_resource
      1.0.0
  </span>
  
</footer>


<script src="static-assets/highlight.pack.js?v1"></script>
<script src="static-assets/docs.dart.js"></script>

</body>
</html>

